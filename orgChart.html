<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src=https://dss1.bdstatic.com/5eN1bjq8AAUYm2zgoY3K/r/www/cache/static/protocol/https/jquery/jquery-1.10.2.min_65682a2.js></script>
    <style>
        #tree_dom {
            position: absolute;
        }
        
        .row {
            zoom: 1;
        }
        
        .row::after {
            content: " ";
            display: block;
            clear: both;
        }
        
        .item {
            display: table-cell;
            /* padding: 0px 10px; */
            position: relative;
        }
        
        .line {
            margin: auto;
            height: 20px;
        }
        
        .line .left {
            width: 50%;
            height: 100%;
            float: left;
            box-sizing: border-box;
            border-right: solid 2px red;
            border-bottom: solid 4px red;
        }
        
        .line .right {
            width: 50%;
            height: 100%;
            float: left;
            box-sizing: border-box;
            border-left: solid 2px red;
            border-bottom: solid 4px red;
        }
        
        .row .item:first-child {
            margin-left: 0px;
        }
        
        .content {
            text-align: center;
            /* background: #eee; */
            margin: auto;
            box-sizing: border-box;
            padding: 0px 10px;
            border-radius: 4px;
            white-space: normal;
        }
        
        .content>.template {
            width: 120px;
            margin: auto;
            background: #eee;
            padding: 10px;
        }
        
        .lineTop {
            width: 4px;
            height: 20px;
            background-color: red;
            margin: auto;
        }
        
        .leftWhite {
            width: 50%;
            height: 4px;
            background-color: #fff;
            margin-top: -4px;
            position: absolute;
            z-index: 1;
            margin-left: -2px;
            left: 0px;
        }
        
        .rightWhite {
            width: 50%;
            height: 4px;
            background-color: #fff;
            margin-top: -4px;
            position: absolute;
            z-index: 1;
            margin-right: -2px;
            right: 0px;
        }
        
        .tag {
            padding: 10px;
            background-color: #eee;
            border-radius: 4px;
            top: 50%;
            width: 120px;
            height: 60px;
        }
        
        .tagBox {
            overflow: hidden;
            width: 560px;
            height: 50px;
            /* background-color: rgb(248, 223, 170); */
        }
        
        .tagBox>div {
            float: left;
            width: 50%;
            height: 100%;
            box-sizing: border-box;
            border-bottom: solid 4px red;
        }
        
        .tagBox div.tagLeft {
            border-right: solid 2px red;
            position: relative;
        }
        
        .tagBox div.tagLeft .noneLine {
            position: absolute;
            border-bottom: solid 4px #fff;
            left: 0px;
            bottom: -4px;
            height: 0px;
            width: 50%;
        }
        
        .tagBox div.tagRight {
            border-left: solid 2px red;
            position: relative;
        }
        
        .tagBox div.tagRight .noneLine {
            position: absolute;
            border-bottom: solid 4px #fff;
            right: 0px;
            bottom: -4px;
            height: 0px;
            width: 50%;
        }
        
        .tagBox div.tagRight .tagItem {
            width: 140px;
            height: 40px;
            background-color: green;
            position: absolute;
            right: 0px;
            top: 50%;
            margin-top: -20px;
            border-radius: 2px;
            color: #fff;
            text-align: center;
            line-height: 40px;
        }
    </style>
</head>

<body>

    <div id="tree_dom">
        <div class="row">
            <div class="item">
                <div class="content">
                    这是内容1
                </div>
                <!-- <div class="lineTop"></div> -->
                <div class="line">
                    <div class="left top">
                    </div>
                    <div class="right top">
                    </div>
                    <div style="clear: both;"></div>
                </div>
                <div class="row">
                    <div class="item">
                        <div class="leftWhite"></div>
                        <div class="lineTop">
                        </div>
                        <div class="content">
                            这是内容1-1
                        </div>
                        <div class="tagBox">
                            <div class="tagLeft"></div>
                            <div class="tagRight">
                                <div class="tagItem">tag节点</div>
                                <div class="noneLine"></div>
                            </div>
                        </div>
                        <div class="line" style="display:none">
                            <div class="left top">
                            </div>
                            <div class="right top">
                            </div>
                            <div style="clear: both;"></div>
                        </div>

                        <div class="row">
                            <div class="item">
                                <div class="leftWhite"></div>
                                <div class="lineTop">
                                </div>
                                <div class="content">
                                    这是内容1-1-1
                                </div>
                            </div>
                            <div class="item">
                                <div class="lineTop">

                                </div>
                                <div class="content">
                                    这是内容1-1-2
                                </div>
                            </div>
                            <div class="item">
                                <div class="rightWhite"></div>
                                <div class="lineTop">

                                </div>
                                <div class="content">
                                    这是内容1-1-3
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="item">
                        <div class="lineTop">

                        </div>
                        <div class="content">
                            这是内容1-2
                        </div>
                        <div class="line">
                            <div class="left top">

                            </div>
                            <div class="right top">

                            </div>
                            <div style="clear: both;"></div>
                        </div>
                        <div class="row">
                            <div class="item">
                                <div class="leftWhite"></div>
                                <div class="lineTop">

                                </div>
                                <div class="content">
                                    这是内容1-2-1
                                </div>
                            </div>
                            <!-- <div class="item">
                                <div class="lineTop">

                                </div>
                                <div class="content">
                                    这是内容1-2-2
                                </div>
                            </div> -->
                            <div class="item">

                                <div class="lineTop">

                                </div>
                                <div class="content">
                                    这是内容1-2-3
                                </div>
                            </div>
                            <div class="item">
                                <div class="rightWhite"></div>

                                <div class="lineTop">

                                </div>
                                <div class="content">
                                    这是内容1-2-4
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="item tags">
                        <div class="rightWhite"></div>
                        <div class="lineTop">
                        </div>
                        <div class="content">
                            tags标签内容
                        </div>
                        <div class="tagBox" style="width:380px;">
                            <div class="tagLeft"></div>
                            <div class="tagRight">
                                <div>这是一个tag节点</div>
                                <div class="noneLine"></div>
                            </div>
                        </div>
                        <div class="line" style="display:none">
                            <div class="left top">
                            </div>
                            <div class="right top">
                            </div>
                            <div style="clear: both;"></div>
                        </div>
                        <div class="row">
                            <div class="item">
                                <div class="rightWhite"></div>
                                <div class="leftWhite"></div>
                                <div class="lineTop"></div>
                                <div class="content">
                                    tags子标签内容
                                </div>
                                <div class="tagBox" style="width:360px;">
                                    <div class="tagLeft"></div>
                                    <div class="tagRight">
                                        <div>这是一个tag节点</div>
                                        <div class="noneLine"></div>
                                    </div>
                                </div>
                                <div class="line" style="display:none;">
                                    <div class="left top">
                                    </div>
                                    <div class="right top">
                                    </div>
                                    <div style="clear: both;"></div>
                                </div>
                                <div class="row">
                                    <div class="item">
                                        <div class="leftWhite"></div>
                                        <div class="lineTop"></div>
                                        <div class="content">
                                            内容
                                        </div>
                                    </div>


                                    <div class="item">
                                        <div class="rightWhite"></div>
                                        <div class="lineTop"></div>
                                        <div class="content">
                                            内容
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>

    </div>
    <div id="orgTree" style="position:absolute;top:600px;left: 50%;
    margin-left: -40%;">

    </div>

</body>

</html>
<script>
    var dataArray = [{
        name: "root",
        children: [{
            name: "1",
            children: [{
                name: "1-1",
            }, {
                name: "1-2"
            }, {
                name: "1-3",
            }, {
                name: "1-4",
            }, ]
        }, {
            name: "2",
            children: [

                {
                    name: "2-1",
                    children: [{
                        name: "2-1-1"
                    }]
                }, {
                    name: "2-2",
                    children: [{
                        name: '2-2-1'
                    }]
                }, {
                    name: "2-4"
                }, {
                    name: 'asdad',
                    type: 'tag'
                }
            ]
        }, {
            name: "3",
            children: [{
                name: "3-1",
            }, {
                name: "3-2"
            }, {
                name: "tag",
                type: "tag"
            }]
        }, {
            name: "4",
            children: [

                {
                    name: "4-1",
                    children: [{
                        name: "4-1-1"
                    }, {
                        name: "4-1-2"
                    }]
                }, {
                    name: "4-2",

                }, {
                    name: 'asdas',
                    type: 'tag'
                }
            ]
        }, {
            name: 'asdad',
            type: 'tag'

        }]
    }];
    !(function(name, factory) {
        if (typeof exports === 'object') {
            module.exports = factory();
        } else if (typeof define === 'function' && define.amd) {

            define(factory);
        } else {

            window[name] = factory();
        }

    })("jqOrgTree", function() {
        var namespace = "jqOrgTree",
            jqOrgTree = {},
            //带有子节点的需要这条dom树
            lineDom = "<div class='line'><div class='left top'></div><div class='right top'></div><div style='clear:both'></div></div>",
            //左叶子树需要
            lineTop = "<div class='lineTop'></div>",
            leftDom = "<div class=leftWhite></div>",
            rightDom = "<div class=rightWhite></div>",
            template = function() {
                var ltemList = "";
                return itemList;
            };
        /**开始疯狂编码**/
        jqOrgTree[namespace] = function() {};
        var tagList = {};

        function buildNode(data) {
            var str = "";
            var template = function(data, vip, root, path) {
                $.each(data, function(index, item) {
                    if (item && item.hasOwnProperty("type") && item.type == "tag") {
                        tagList[path] = data.splice(index, 1)[0];
                        tagList[path].path = path + "-" + index;
                    }
                })
                var s = "",
                    len = data.length,
                    parent = path || "";
                $.each(data, function(index, item) {

                    var path = "";
                    if (!parent) {
                        path = index;
                    } else {
                        path = parent + '-' + index;
                    }
                    //s += `<div class="item" data-path=${path}>${vip?rightDom:''}${index==0&&!root?leftDom:index==len-1?rightDom:''}${root?'':lineTop}<div class="content"><div class="template">${item.name+'<b style=color:red>'+path+'</b>'}</div></div>${item.children?`${lineDom}<div class="row">${template(item.children,item.children.length==1,false,parent+(parent&&"-")+index)}</div>`:''}</div>`;
                    s += "<div class=\"item\" data-path=".concat(path, ">").concat(vip ? rightDom : '').concat(index == 0 && !root ? leftDom : index == len - 1 ? rightDom : '').concat(root ? '' : lineTop, "<div class=\"content\"><div class=\"template\">").concat(item.name + '<b style=color:red>' + path + '</b>', "</div></div>").concat(item.children ? "".concat(lineDom, "<div class=\"row\">").concat(template(item.children, item.children.length == 1, false, parent + (parent && "-") + index), "</div>") : '', "</div>");
                })
                return s;
            };
            return "<div class='row'>" + template(data, false, true) + "</div>";
        }
        document.getElementById('orgTree').innerHTML = buildNode(dataArray);
        /**局部处理tag标记**/
        function reverseObject(object) {
            /**反转对象**/
            var newObject = {};
            var keys = [];

            for (var key in object) {
                keys.push(key);
            }

            for (var i = keys.length - 1; i >= 0; i--) {
                var value = object[keys[i]];
                newObject[keys[i]] = value;
            }

            return newObject;
        }
        // $.each(reverseObject(tagList), function(path, value) {
        //     var vnode = $(".item[data-path='" + path + "']");
        //     var tagWidth = 0;
        //     var tagHeight = 0;
        //     var row = vnode.children(".row");
        //     var rowWidth = row.width();
        //     var tagContent = $("<div class='tagContent' style='padding:20px;text-align:center;border:solid 1px red;width:120px'>" + value.path + "</div>");
        //     var tagBox = $('<div class="tagBox"><div class="tagLeft"><div class="noneLine"></div></div><div class="tagRight"><div class="noneLine"></div></div></div>');
        //     vnode.children(".line").replaceWith(tagBox);
        //     vnode.children(".tagBox").children(".tagRight").append(tagContent);
        //     tagHeight = tagContent.outerHeight();
        //     tagContent.css({
        //         position: "absolute",
        //         top: "50%",
        //         marginTop: -tagHeight / 2 + "px",
        //         right: 0
        //     })
        //     tagWidth = tagContent.outerWidth();
        //     tagBox.css({
        //         height: tagHeight + 60 + "px",
        //         width: rowWidth + tagWidth - 2 + "px"
        //     })
        //     tagBox.children(".tagLeft").css({
        //         [row.children('.item').length == 1 && 'border-bottom']: "none"
        //     }).children(".noneLine").css({
        //         width: Math.floor(row.children('.item').eq(0).children('.leftWhite').width() / (tagBox.width() / 2) * 100) + "%",

        //     })
        //     tagBox.children(".tagRight").css({
        //         [row.children('.item').length == 1 && 'border-bottom']: "none"
        //     }).children(".noneLine").css({
        //         width: Math.floor(row.children('.item').last().children('.rightWhite').width() / (tagBox.width() / 2) * 100) + "%",
        //     })
        //     row.css({
        //         paddingLeft: row.children(".item").length > 1 && (tagWidth) / 2 - 1 + "px"
        //     })

        // })
    })
</script>